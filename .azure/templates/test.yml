steps:
- checkout: none
- download: current
  
- task: ExtractFiles@1
  inputs:
    archiveFilePatterns: $(Pipeline.Workspace)/drop/*.zip
    destinationFolder: drop

- task: Bash@3
displayName: 'Deploy to https://sswrulesstaging.firebaseapp.com/rules/'
inputs:
  targetType: 'inline'
  script: |
    npm install -g firebase-tools
    mkdir firebase && mv public firebase/rules
    firebase deploy --token $(FIREBASETOKEN)
- task: Bash@3
displayName: 'SSW CodeAuditor - Check broken links and performance'
inputs:
  targetType: 'inline'
  script: 'docker container run --rm --cap-add=SYS_ADMIN -v "$(Build.SourcesDirectory)/src:/home/lhci/app/src" sswconsulting/codeauditor --url https://sswrulesstaging.firebaseapp.com/rules/ --lighthouse --token 828ea8af-66c6-4ff5-63c1-9606e3c702d2 --buildId $(Build.BuildNumber)'
